<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Therapist Bookings | HealingTouch</title>

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --spa-green: #6b8e6b;
            --spa-green-dark: #4a7c59;
            --spa-cream: #faf5e6;
            --spa-beige: #f5f5dc;

            --pending: #fff3cd;
            --confirmed: #d4edda;
            --declined: #f8d7da;
            --cancelled: #fce1e1;
            --completed: #d1ecf1;
        }

        body {
            background: linear-gradient(135deg,var(--spa-cream),var(--spa-beige));
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, sans-serif;
        }

        .page-title {
            text-align: center;
            margin: 2rem 0;
            font-size: 2.5rem;
            color: var(--spa-green-dark);
            font-weight: 700;
        }

        .booking-card {
            background: #fff;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(107,142,107,.2);
            box-shadow: 0 4px 12px rgba(0,0,0,.07);
            transition: .2s ease;
        }

        .booking-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,.1);
        }

        .status-badge {
            padding: .5rem 1rem;
            border-radius: 20px;
            text-transform: uppercase;
            font-size: .85rem;
            font-weight: 700;
        }

        .status-pending { background: var(--pending); color: #856404; }
        .status-confirmed { background: var(--confirmed); color: #155724; }
        .status-declined { background: var(--declined); color: #721c24; }
        .status-cancelled { background: var(--cancelled); color: #7a1f1f; }
        .status-completed { background: var(--completed); color: #0c5460; }

        .action-btn {
            border-radius: 25px;
            padding: .6rem 1.5rem;
            font-weight: 700;
            color: #fff;
            border: none;
        }

        .approve-btn { background: #28a745; }
        .decline-btn { background: #dc3545; }
        .complete-btn { background: var(--spa-green); }

        .approve-btn:hover { background: #1e7e34; }
        .decline-btn:hover { background: #b52e3a; }
        .complete-btn:hover { background: var(--spa-green-dark); }
    </style>
</head>

<body>

<div th:replace="~{fragments/header :: header}"></div>

<main class="container">

    <h1 class="page-title">
        <i class="fas fa-calendar-alt me-2"></i>My Bookings
    </h1>

    <!-- List of bookings -->
    <div th:if="${therapistBookings != null and !therapistBookings.isEmpty()}">

        <div th:each="booking : ${therapistBookings}" class="booking-card">

            <!-- Header -->
            <div class="d-flex justify-content-between align-items-start mb-3">

                <div>
                    <h4 class="mb-1" th:text="${booking.massageType}">Massage</h4>

                    <span class="status-badge"
                          th:classappend="' status-' + ${booking.status.name().toLowerCase()}"
                          th:text="${booking.status}">
                    </span>
                </div>

                <h4 class="text-success fw-bold"
                    th:text="${'$' + booking.price}">
                </h4>
            </div>

            <!-- Details -->
            <div class="row mb-3">

                <div class="col-md-4">
                    <p class="mb-1 text-muted"><i class="fas fa-user"></i> Client</p>
                    <p class="fw-bold" th:text="${booking.customerName}">John Doe</p>
                </div>

                <div class="col-md-4">
                    <p class="mb-1 text-muted"><i class="fas fa-calendar"></i> Date</p>
                    <p class="fw-bold"
                       th:text="${#temporals.format(booking.startTime,'MMM dd, yyyy')}"></p>
                </div>

                <div class="col-md-4">
                    <p class="mb-1 text-muted"><i class="fas fa-clock"></i> Time</p>
                    <p class="fw-bold"
                       th:text="${#temporals.format(booking.startTime,'HH:mm') + ' - ' +
                                #temporals.format(booking.endTime,'HH:mm')}"></p>
                </div>
            </div>

            <!-- Client Notes -->
            <div th:if="${booking.notes}" class="alert alert-warning mt-3">
                <strong><i class="fas fa-sticky-note me-2"></i>Client Notes:</strong>
                <span th:text="${booking.notes}"></span>
            </div>

            <!-- Pending Actions -->
            <div th:if="${booking.status.name() == 'PENDING'}" class="d-flex gap-2 mt-3">

                <form th:action="@{'/bookings/' + ${booking.id} + '/approve'}" method="post">
                    <button class="action-btn approve-btn">
                        <i class="fas fa-check me-2"></i>Approve
                    </button>
                </form>

                <form th:action="@{'/bookings/' + ${booking.id} + '/decline'}" method="post"
                      onsubmit="return confirm('Are you sure you want to decline this booking?');">
                    <button class="action-btn decline-btn">
                        <i class="fas fa-times me-2"></i>Decline
                    </button>
                </form>
            </div>

            <!-- Confirmed Action -->
            <div th:if="${booking.status.name() == 'CONFIRMED'}" class="mt-3">
                <form th:action="@{'/bookings/' + ${booking.id} + '/complete'}" method="post">
                    <button class="action-btn complete-btn">
                        <i class="fas fa-check-circle me-2"></i>Mark as Completed
                    </button>
                </form>
            </div>

            <!-- No Actions -->
            <div th:if="${booking.status.name() != 'PENDING'
                          and booking.status.name() != 'CONFIRMED'}"
                 class="mt-2 text-muted">
                <i>*No further actions available for this booking*</i>
            </div>

        </div>
    </div>

    <!-- Empty state -->
    <div th:if="${therapistBookings == null or therapistBookings.isEmpty()}"
         class="text-center mt-5">
        <i class="fas fa-calendar-times fa-4x text-muted"></i>
        <h3 class="mt-3">No Bookings Yet</h3>
        <p class="text-muted">Clients haven't booked any sessions yet.</p>
    </div>

</main>

<div th:replace="~{fragments/footer :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
